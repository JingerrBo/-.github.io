<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤¢éŠæŠ½çç³»çµ±</title>
    <style>
        /* CSS æ¨£å¼ (æ­¤è™•çœç•¥ä»¥ä¿æŒç°¡æ½”ï¼Œå¯¦éš›ä»£ç¢¼ä¸­åŒ…å«å®Œæ•´æ¨£å¼) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-family: 'Microsoft JhengHei', Arial, sans-serif; min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: #ffd700; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; gap: 15px; }
        .trophy { font-size: 1.2em; }
        .stats { color: rgba(255,255,255,0.8); font-size: 1.1em; margin-top: 10px; }
        .main-content { display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        .draw-section { background: rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .draw-area { background: rgba(0,0,0,0.2); border-radius: 15px; height: 200px; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.6); font-size: 1.2em; margin-bottom: 20px; position: relative; overflow: hidden; }
        .draw-area.drawing { animation: pulse 0.5s infinite alternate; }
        @keyframes pulse { from { background: rgba(0,0,0,0.2); } to { background: rgba(255,215,0,0.1); } }
        .draw-buttons { display: flex; gap: 15px; justify-content: center; }
        .btn { padding: 12px 25px; border: none; border-radius: 25px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(45deg, #4CAF50, #45a049); color: white; }
        .btn-danger { background: linear-gradient(45deg, #f44336, #d32f2f); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .prizes-section { background: rgba(255,255,255,0.1); border-radius: 20px; padding: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); margin-top: 20px; }
        .section-title { color: #ffd700; font-size: 1.3em; font-weight: bold; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .prize-item { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 12px 15px; border-radius: 8px; margin-bottom: 8px; color: white; }
        .prize-name { font-weight: 500; }
        .prize-count { color: #ffd700; font-weight: bold; }
        .sidebar { display: flex; flex-direction: column; gap: 20px; }
        .settings-panel, .participants-panel { background: rgba(255,255,255,0.1); border-radius: 20px; padding: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; color: white; }
        .setting-controls { display: flex; align-items: center; gap: 10px; }
        .count-input { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 5px; color: white; padding: 5px 10px; width: 50px; text-align: center; }
        .count-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 25px; height: 25px; border-radius: 3px; cursor: pointer; font-weight: bold; }
        .add-prize-btn { background: rgba(255,215,0,0.2); border: 1px dashed #ffd700; color: #ffd700; padding: 10px; border-radius: 8px; cursor: pointer; text-align: center; margin-top: 10px; transition: all 0.3s ease; }
        .participants-panel { max-height: 500px; }
        #participantsList { max-height: 350px; overflow-y: auto; }
        #participantsList::-webkit-scrollbar { width: 6px; }
        #participantsList::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 3px; }
        #participantsList::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }
        .reset-all-btn { background: linear-gradient(45deg, #9c27b0, #7b1fa2); color: white; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-bottom: 15px; transition: all 0.3s ease; }
        .participant-item { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 10px 15px; border-radius: 8px; margin-bottom: 8px; color: white; cursor: pointer; transition: background 0.3s; }
        .participant-item:hover { background: rgba(255,255,255,0.1); }
        .participant-item.drawn { background: rgba(76,175,80,0.3); }
        .status-indicator { font-weight: bold; }
        .participant-item.drawn .status-indicator { color: #81C784; }
        .participant-item:not(.drawn) .status-indicator { color: #E57373; }
        .result-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #ffd700; font-size: 1.5em; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.5s ease; }
        .result-display.show { opacity: 1; }
        .preparing-text { font-size: 1.2em; color: rgba(255,255,255,0.7); animation: blink 1s infinite; }
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0.5; } }
        .results-section { margin-top: 40px; background: rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .prize-result-card { background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%); border-radius: 15px; padding: 20px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); transition: transform 0.3s ease; }
        .prize-result-card:hover { transform: translateY(-5px); }
        .prize-result-title { font-size: 1.3em; font-weight: bold; color: white; text-align: center; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .winners-list { background: rgba(255,255,255,0.9); border-radius: 10px; padding: 15px; }
        .winner-name { background: rgba(255,255,255,0.8); color: #333; padding: 8px 12px; margin: 5px 0; border-radius: 8px; font-weight: 500; text-align: center; border-left: 4px solid #ff6b35; }
        @media (max-width: 768px) { .main-content { grid-template-columns: 1fr; } .header h1 { font-size: 2em; } .results-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>
                <span class="trophy">ğŸ†</span>
                å¤¢éŠæŠ½çç³»çµ±
                <span class="trophy">ğŸ†</span>
            </h1>
            <div class="stats" id="statsDisplay">
                å‡ºå¸­: 0 | å¯æŠ½çäººæ•¸: 0 | å‰©é¤˜çå“: 0
            </div>
        </header>

        <div class="main-content">
            <div>
                <div class="draw-section">
                    <div class="draw-area" id="drawArea">
                        <div class="preparing-text" id="preparingText">æº–å‚™æŠ½ç...</div>
                        <div class="result-display" id="resultDisplay"></div>
                    </div>
                    <div class="draw-buttons">
                        <button class="btn btn-primary" id="startDrawBtn">âš¡ é–‹å§‹æŠ½ç</button>
                        <button class="btn btn-danger" id="resetBtn">ğŸ”„ é‡ç½®</button>
                    </div>
                </div>

                <div class="prizes-section">
                    <div class="section-title">ğŸ† çé …é€²åº¦</div>
                    <div id="prizesList"></div>
                </div>
            </div>

            <div class="sidebar">
                <div class="settings-panel" id="settingsPanel">
                    </div>

                <div class="participants-panel">
                    <div class="section-title">ğŸ‘¥ åƒèˆ‡è€…åå–®</div>
                    <button class="reset-all-btn" id="toggleAllBtn">å…¨éƒ¨é¸å–</button>
                    <div id="participantsList">
                        </div>
                </div>
            </div>
        </div>
        </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- è³‡æ–™çµæ§‹ ---
    // çå“ç‰©ä»¶
    let prizes = {
        'ç«ç„°å¢å¹…': { current: 0, max: 0 }, 'ç¶ æœ¨å¢å¹…': { current: 0, max: 0 },
        'é­”æ³•æ›¸ç®±': { current: 0, max: 0 }, 'é€†è½‰': { current: 0, max: 0 },
        'å¨ƒå¨ƒ': { current: 0, max: 0 }, 'åé¨': { current: 0, max: 0 },
        'é®å®ˆ': { current: 0, max: 0 }, 'çªè¥²': { current: 0, max: 0 },
        'ç®±å­': { current: 0, max: 0 }
    };

    // åƒèˆ‡è€…åå–®
    let participants = [
        { name: 'æ›‰å¤§', drawn: false }, { name: 'æ…é‡çš„ç´…èŒ¶', drawn: false }, { name: 'æ³¢å¦è¥¿å‘±å˜', drawn: false },
        { name: 'åº«æ–¯å¡”', drawn: false }, { name: 'æ„›éº—å…”', drawn: false }, { name: 'å°æ•¸å­—', drawn: false },
        { name: 'è²“è²“å®¶è£¡èºº', drawn: false }, { name: 'è·¯åå››', drawn: false }, { name: 'é˜¿çˆ¾æ•X', drawn: false },
        { name: 'ä¾é çš„æ˜ŸæœŸäº”', drawn: false }, { name: 'ç‡•å‚¾åŸ', drawn: false }, { name: 'å†·é…·çš„è¦', drawn: false },
        { name: 'ç„¡æƒ…çš„é›¢è·', drawn: false }, { name: 'æ—è›‹çš„è›‹å¡”', drawn: false }, { name: 'å¤©çœŸçš„å¡ä¼Šæ€', drawn: false },
        { name: 'ç„¡æ¸ºè¯', drawn: false }, { name: 'æƒ¡é­”çš„ç¥­å“', drawn: false }, { name: 'ç ´å£ç¥é ˜åŸŸ', drawn: false },
        { name: 'ç„¡æ•µå…”å…”', drawn: false }, { name: 'åˆ—ç‰¹å¨œè’‚çµ²', drawn: false }, { name: 'ä¹‚å€«æ¬¸', drawn: false },
        { name: 'æŸ“è‰²é«”', drawn: false }, { name: 'ç‡ƒç‡’ç«è…¿', drawn: false }, { name: 'å§‹å†¬', drawn: false },
        { name: 'æ­ç³å¨œ', drawn: false }, { name: 'è„æ°£å°å¥³è‘¡', drawn: false }, { name: 'ç±³è²æ–¯', drawn: false },
        { name: 'ä¾†è‡ªå—æ¥µçš„é›ªç³•', drawn: false }, { name: 'å¸ƒæœ—å°¼æƒ³æ€æ¨£?', drawn: false }, { name: 'å°å°å¼“å‰æ‰‹', drawn: false },
        { name: 'å¥¶èŒ¶åŠç³–å¾®å†°', drawn: false }, { name: 'æµ·æ´‹ç¤¦æ³‰æ°´', drawn: false }, { name: 'é­šé­šå®¶è£¡åƒ', drawn: false },
        { name: 'æº«æŸ”çš„å¤§å­¸ç”Ÿ', drawn: false }, { name: 'ç«é¾æœèµ·å¸å¡”', drawn: false }, { name: 'ç™½ç‰è¥¿å‘±', drawn: false },
        { name: 'æœˆå…‰ä¸‹çš„ç«¥è©±', drawn: false }, { name: 'ä¾ç„¶é£¯å¤ªç¨€', drawn: false }, { name: 'å–çš„æ™‚å€™Qoo', drawn: false },
        { name: 'å°ç€', drawn: false }, { name: 'é¢¯å½Œäº', drawn: false }, { name: 'é˜²è­·å£ç½©', drawn: false },
        { name: 'é³¶å°¾æ —', drawn: false }, { name: 'è¹¦è·³é¨å£«', drawn: false }, { name: 'Azisha', drawn: false },
        { name: 'ErikaTang', drawn: false }, { name: 'Meco', drawn: false }, { name: 'Yoseido', drawn: false },
        { name: 'nisa', drawn: false }, { name: 'JLY', drawn: false }
    ];

    // å…¨å±€ç‹€æ…‹
    let isDrawing = false;
    let allTimeWinners = {}; // å­˜å„²æ‰€æœ‰ä¸­çè€…ï¼Œç”¨æ–¼é˜²æ­¢é‡è¤‡ä¸­çå’Œç´¯è¨ˆé¡¯ç¤º

    // --- DOM å…ƒç´  ---
    const startDrawBtn = document.getElementById('startDrawBtn');
    const resetBtn = document.getElementById('resetBtn');
    const toggleAllBtn = document.getElementById('toggleAllBtn');
    const statsDisplay = document.getElementById('statsDisplay');
    const prizesListEl = document.getElementById('prizesList');
    const participantsListEl = document.getElementById('participantsList');
    const settingsPanelEl = document.getElementById('settingsPanel');
    const drawArea = document.getElementById('drawArea');
    const preparingText = document.getElementById('preparingText');
    const resultDisplay = document.getElementById('resultDisplay');

    // --- æ ¸å¿ƒå‡½å¼ ---

    /** æ›´æ–°é ‚éƒ¨çµ±è¨ˆæ•¸æ“š */
    function updateStats() {
        const attendedCount = participants.filter(p => p.drawn).length;
        const pastWinners = Object.values(allTimeWinners).flat();
        const availableToWinCount = participants.filter(p => p.drawn && !pastWinners.includes(p.name)).length;
        const remainingPrizes = Object.values(prizes).reduce((sum, prize) => sum + prize.current, 0);

        statsDisplay.innerHTML = `å‡ºå¸­: ${attendedCount} | å¯æŠ½çäººæ•¸: ${availableToWinCount} | å‰©é¤˜çå“: <span id="remaining-prizes">${remainingPrizes}</span>`;
    }

    /** æ›´æ–°å·¦ä¸‹è§’çé …é€²åº¦é¡¯ç¤º */
    function updatePrizeProgress() {
        prizesListEl.innerHTML = Object.entries(prizes)
            .map(([name, data]) => `
                <div class="prize-item">
                    <span class="prize-name">${name}</span>
                    <span class="prize-count">${allTimeWinners[name]?.length || 0} / ${data.max}</span>
                </div>
            `).join('');
        updateStats();
    }

    /** é‡æ–°æ¸²æŸ“å³å´çš„çé …è¨­å®šé¢æ¿ */
    function renderSettingsPanel() {
        const prizeSettingsHTML = Object.entries(prizes).map(([name, data]) => `
            <div class="setting-item">
                <span>${name}</span>
                <div class="setting-controls">
                    <input type="number" class="count-input" value="${data.current}" min="0" data-prize="${name}">
                    <button class="count-btn" data-action="remove" data-prize="${name}">Ã—</button>
                </div>
            </div>
        `).join('');

        settingsPanelEl.innerHTML = `
            <div class="section-title">âš™ï¸ çé …è¨­å®š</div>
            ${prizeSettingsHTML}
            <div class="add-prize-btn" data-action="add">+ æ–°å¢çé …ç¨®é¡</div>
        `;
    }

    /** é‡æ–°æ¸²æŸ“åƒèˆ‡è€…åå–® */
    function renderParticipantsList() {
        participantsListEl.innerHTML = participants.map((p, index) => `
            <div class="participant-item ${p.drawn ? 'drawn' : ''}" data-index="${index}">
                <span>${p.name}</span>
                <span class="status-indicator">${p.drawn ? 'âœ“ å‡ºå¸­' : 'âœ• æœªå‡ºå¸­'}</span>
            </div>
        `).join('');
        updateToggleAllButton();
    }
    
    /** æ›´æ–° "å…¨éƒ¨é¸å–/å–æ¶ˆ" æŒ‰éˆ•çš„ç‹€æ…‹å’Œæ–‡å­— */
    function updateToggleAllButton() {
        const attendedCount = participants.filter(p => p.drawn).length;
        toggleAllBtn.textContent = (attendedCount === participants.length) ? 'å…¨éƒ¨å–æ¶ˆ' : 'å…¨éƒ¨é¸å–';
    }

    /** é–‹å§‹æŠ½ç */
    function startDraw() {
        if (isDrawing) return;

        const availablePrizes = Object.entries(prizes).flatMap(([name, data]) => Array(data.current).fill(name));
        if (availablePrizes.length === 0) {
            alert('æ²’æœ‰å¯æŠ½çš„çå“ï¼è«‹å…ˆåœ¨å³å´è¨­å®šçé …æ•¸é‡ã€‚');
            return;
        }

        const pastWinners = Object.values(allTimeWinners).flat();
        const availableParticipants = participants.filter(p => p.drawn && !pastWinners.includes(p.name));
        
        if (availableParticipants.length < availablePrizes.length) {
            alert(`å¯æŠ½çäººæ•¸ (${availableParticipants.length}) ä¸è¶³ï¼\néœ€è¦ ${availablePrizes.length} ä½æ‰èƒ½æŠ½å®Œæ‰€æœ‰çå“ã€‚`);
            return;
        }

        isDrawing = true;
        startDrawBtn.disabled = true;
        drawArea.classList.add('drawing');
        preparingText.style.display = 'none';
        resultDisplay.textContent = 'æŠ½çä¸­...';
        resultDisplay.classList.add('show');

        // æ¨¡æ“¬æŠ½çå‹•ç•«
        setTimeout(() => {
            const shuffledParticipants = [...availableParticipants].sort(() => Math.random() - 0.5);
            
            availablePrizes.forEach((prizeName, index) => {
                const winner = shuffledParticipants[index].name;
                if (!allTimeWinners[prizeName]) {
                    allTimeWinners[prizeName] = [];
                }
                allTimeWinners[prizeName].push(winner);
                prizes[prizeName].current = 0; // æŠ½å®Œå¾Œå°‡ç•¶å‰å¯æŠ½æ•¸æ­¸é›¶
            });
            
            resultDisplay.textContent = 'æŠ½çå®Œæˆï¼';
            drawArea.classList.remove('drawing');
            
            renderSettingsPanel();
            updatePrizeProgress();
            displayDrawResults();

            setTimeout(() => {
                isDrawing = false;
                startDrawBtn.disabled = false;
            }, 1000);

        }, 3000); // æŠ½çå‹•ç•«æŒçºŒ3ç§’
    }

    /** é¡¯ç¤ºä¸­ççµæœ */
    function displayDrawResults() {
        let resultsSection = document.getElementById('drawResults');
        if (!resultsSection) {
            resultsSection = document.createElement('div');
            resultsSection.id = 'drawResults';
            resultsSection.className = 'results-section';
            document.querySelector('.container').appendChild(resultsSection);
        }
        
        const resultsHTML = Object.entries(allTimeWinners).map(([prizeName, winners]) => {
            if (winners.length === 0) return '';
            const winnerListHTML = winners.map(winner => `<div class="winner-name">${winner}</div>`).join('');
            return `
                <div class="prize-result-card">
                    <div class="prize-result-title">${prizeName} (${winners.length})</div>
                    <div class="winners-list">${winnerListHTML}</div>
                </div>`;
        }).join('');

        resultsSection.innerHTML = `<div class="section-title">ğŸ“‹ ä¸­çåå–®</div><div class="results-grid">${resultsHTML}</div>`;
        if (resultsHTML.trim()) {
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
    }
    
    /** å®Œå…¨é‡ç½®ç³»çµ± */
    function resetSystem() {
        if (!confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è¨­å®šå’Œä¸­çç´€éŒ„å—ï¼Ÿ')) return;
        
        isDrawing = false;
        allTimeWinners = {};
        
        Object.keys(prizes).forEach(name => {
            prizes[name].current = 0;
            prizes[name].max = 0;
        });

        drawArea.classList.remove('drawing');
        preparingText.style.display = 'block';
        resultDisplay.classList.remove('show');
        resultDisplay.textContent = '';
        startDrawBtn.disabled = false;

        const resultsSection = document.getElementById('drawResults');
        if (resultsSection) resultsSection.remove();

        renderAll();
    }
    
    /** é‡æ–°æ¸²æŸ“æ‰€æœ‰ç›¸é—œçš„UIçµ„ä»¶ */
    function renderAll() {
        renderSettingsPanel();
        renderParticipantsList();
        updatePrizeProgress(); // æ­¤å‡½æ•¸å…§éƒ¨æœƒèª¿ç”¨ updateStats
    }

    // --- äº‹ä»¶è™•ç† ---

    // è™•ç†è¨­å®šé¢æ¿çš„é»æ“Šäº‹ä»¶ (æ–°å¢/ç§»é™¤çé …)
    settingsPanelEl.addEventListener('click', (e) => {
        const target = e.target.closest('[data-action]');
        if (!target) return;

        const action = target.dataset.action;
        const prizeName = target.dataset.prize;

        if (action === 'add') {
            const newPrizeName = prompt('è«‹è¼¸å…¥æ–°çé …åç¨±:');
            if (newPrizeName && !prizes[newPrizeName]) {
                prizes[newPrizeName] = { current: 0, max: 0 };
                renderAll();
            } else if (prizes[newPrizeName]) {
                alert('çé …åç¨±å·²å­˜åœ¨ï¼');
            }
        } else if (action === 'remove') {
            if (confirm(`ç¢ºå®šè¦ç§»é™¤çé … "${prizeName}" å—ï¼Ÿæ‰€æœ‰ç›¸é—œä¸­çç´€éŒ„ä¹Ÿæœƒè¢«æ¸…é™¤ã€‚`)) {
                delete prizes[prizeName];
                delete allTimeWinners[prizeName];
                renderAll();
                displayDrawResults();
            }
        }
    });

    // è™•ç†çé …æ•¸é‡è¼¸å…¥
    settingsPanelEl.addEventListener('change', (e) => {
        if (e.target.classList.contains('count-input')) {
            const prizeName = e.target.dataset.prize;
            const value = parseInt(e.target.value, 10) || 0;
            if (prizes[prizeName]) {
                prizes[prizeName].current = value;
                prizes[prizeName].max = Math.max(prizes[prizeName].max, value); // æœ€å¤§å€¼åªå¢ä¸æ¸›
                updatePrizeProgress();
            }
        }
    });
    
    // é»æ“Šåƒèˆ‡è€…åˆ‡æ›å‡ºå¸­ç‹€æ…‹
    participantsListEl.addEventListener('click', (e) => {
        const target = e.target.closest('.participant-item');
        if (target) {
            const index = parseInt(target.dataset.index, 10);
            participants[index].drawn = !participants[index].drawn;
            renderParticipantsList();
            updateStats();
        }
    });
    
    // é»æ“Š "å…¨éƒ¨é¸å–/å–æ¶ˆ"
    toggleAllBtn.addEventListener('click', () => {
        const isAllAttended = participants.filter(p => p.drawn).length === participants.length;
        const newStatus = !isAllAttended;
        participants.forEach(p => p.drawn = newStatus);
        renderParticipantsList();
        updateStats();
    });

    // ä¸»æŒ‰éˆ•äº‹ä»¶
    startDrawBtn.addEventListener('click', startDraw);
    resetBtn.addEventListener('click', resetSystem);

    // --- åˆå§‹è¼‰å…¥ ---
    renderAll();
});
</script>
</body>
</html>